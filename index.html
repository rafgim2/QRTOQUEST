<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Abrir en Meta Quest</title>

<style>
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: system-ui, sans-serif;
    text-align: center;
  }

  #video {
    width: 90%;
    margin-top: 20px;
    border-radius: 12px;
  }

  #result {
    margin-top: 20px;
    font-size: 18px;
    word-break: break-all;
  }

  button {
    margin-top: 20px;
    padding: 12px 20px;
    border-radius: 10px;
    border: none;
    background: #4aa3ff;
    color: #fff;
    font-size: 18px;
    cursor: pointer;
  }

  button:active {
    background: #3377cc;
  }
</style>

<!-- Librería ZXing para escaneo QR -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

</head>
<body>

<h2>Escanea un código QR<br>para abrirlo en tus Meta Quest</h2>

<video id="video" playsinline></video>
<div id="result"></div>
<button id="openBtn" style="display:none;">Abrir en Quest</button>

<script>
const video = document.getElementById("video");
const resultEl = document.getElementById("result");
const openBtn = document.getElementById("openBtn");

let lastURL = null;

async function startScanner() {
  const codeReader = new ZXing.BrowserMultiFormatReader();

  try {
    const devices = await ZXing.BrowserMultiFormatReader.listVideoInputDevices();
    const camera = devices[0].deviceId;

    await codeReader.decodeFromVideoDevice(camera, video, (res) => {
      if (res) handleQR(res.text);
    });

  } catch (e) {
    resultEl.textContent = "No se pudo acceder a la cámara: " + e;
  }
}

function handleQR(url) {
  lastURL = url;
  resultEl.innerHTML = `Contenido leído:<br><b>${url}</b>`;

  // Intento automático de abrir en Quest
  openInQuest(url);

  // Activa el botón manual por si acaso
  openBtn.style.display = "inline-block";
}

function openInQuest(url) {
  const deepLink = `metaquest://open/?url=${encodeURIComponent(url)}`;
  window.location.href = deepLink;

  console.log("Intentando abrir en Quest:", deepLink);
}

openBtn.onclick = () => {
  if (lastURL) openInQuest(lastURL);
};

startScanner();
</script>

</body>
</html>
